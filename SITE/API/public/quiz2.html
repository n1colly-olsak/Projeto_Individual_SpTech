<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet" href="css/quiz2.css" />
</head>

<body>

    <header>
        <div class="navegacao">
            <div class="olaUser">
                <span>Olá, user</span>
            </div>

            <ul class="navbar">
                <li><a href="index.html">Início</a></li>
                <li><a href="dashboard.html">Acessar dashboard</a></li>
            </ul>
        </div>
    </header>

    <div class="principal">

        <div class=titulo>

            <h2>Quiz</h2>

        </div>

        <div class="areaQuiz" id="areaQuiz">

            <h2>Sobre esse quiz</h2>
            <p>Após navegar pelo site, está na hora de testar seus conhecimentos sobre a ginástica rítmica.</p>
            <p>Responda às 8 perguntas do quiz e depois visualize seus dados na dashboard.</p>
            <p>Na dashboard, você pode acompanhar a sua evolução no tema.</p>
            <button onclick="IniciarQuiz()">Iniciar Quiz</button>

        </div>
    </div>

</body>

</html>
<script>

    var contAcerto = 0;
    var indiceAtual = 0; // percorrer minha variavel perguntas
    var erro = 0;

    var fkUsuario = sessionStorage.ID_USUARIO; //pegando o id do usuário ao fazer o login
    var nomeUsuario = sessionStorage.NOME_USUARIO; //pegando o nomme do usuário ao fazer o login

    // após pegar os id, será possivel colocar novos valores dentro desssas divs 
    var pergunta = document.getElementById("h2_pergunta"); // pegando o id da div que vai a pergunta
    var alternativa = document.getElementById("id_div_alternativas"); // pegadno o id da div que vai as alternativas

    var telaInicial = `
    <h2>Sobre esse quiz</h2>
    <p>Após navegar pelo site, está na hora de testar seus conhecimentos sobre a ginástica rítmica.</p>
    <p>Responda às 8 perguntas do quiz e depois visualize seus dados na dashboard.</p>
    <p>Na dashboard, você pode acompanhar a sua evolução no tema.</p>
    <button onclick="IniciarQuiz()">Iniciar Quiz</button>
`;

    var perguntas = [
        {
            pergunta: "A ginástica rítmica combina movimentos corporais com elementos de qual área artística?",
            certa: "Teatro e ballet",
            alternativas: [
                "Escultura",
                "Teatro e ballet",
                "Pintura",
                "Poesia",
            ],
        },
        {
            pergunta: "Qual desses itens NÃO é um aparelho utilizado na ginástica rítmica?",
            certa: "Trave",
            alternativas: [
                "Corda",
                "Arco",
                "Trave",
                "Fita",
            ],
        },
        {
            pergunta: "Quando a ginástica rítmica passou a ser modalidade competitiva nos Jogos Olímpicos?",
            certa: "1984",
            alternativas: [
                "1942",
                "1980",
                "1984",
                "1996",
            ],
        },
        {
            pergunta: "Em que país ocorreu o primeiro campeonato nacional de ginástica rítmica, em 1942?",
            certa: "União Soviética",
            alternativas: [
                "União Soviética",
                "Canadá",
                "Alemanha",
                "Japão",
            ],
        },
        {
            pergunta: "Qual foi a primeira campeã mundial da ginástica rítmica, em 1963?",
            certa: "Ludmila Savinkova",
            alternativas: [
                "Isadora Duncan",
                "Lori Fung",
                "Rosália Medau",
                "Ludmila Savinkova",
            ],
        },
        {
            pergunta: "Em qual edição olímpica a prova de conjunto (grupos) estreou?",
            certa: "Atlanta 1996",
            alternativas: [
                "Los Angeles 1984",
                "Atlanta 1996",
                "Atenas 2004",
                "Moscou 1980",
            ],
        },
        {
            pergunta: "Em competições oficiais, a área (tablado) onde a ginasta se apresenta mede:",
            certa: "13 x 13 m",
            alternativas: [
                "13 x 13 m",
                "10 x 10 m",
                "20 x 20 m",
                "18 x 18 m",
            ],
        },
        {
            pergunta: "Quem levou a ginástica rítmica para a União Soviética, iniciando seu desenvolvimento como prática independente?",
            certa: "Isadora Duncan",
            alternativas: [
                "Guts Muths",
                "Rudolf Bode",
                "Isadora Duncan",
                "Heinrich Medau",
            ],
        },
    ];

    function IniciarQuiz() {
        var area = document.getElementById("areaQuiz");

        area.innerHTML = `
        <div class="quiz">
            <h2 id="h2_pergunta"></h2>
            <div class="div_alternativas" id="id_div_alternativas"></div>
        </div>
        <button id="proxima" onclick="proxima()">Próxima pergunta</button>
    `;

        pergunta = document.getElementById("h2_pergunta");
        alternativa = document.getElementById("id_div_alternativas");

        carregarPergunta();
    }

    function carregarPergunta() {
        // na minha lista de perguntas, o indice atual esta em zero, pegando meu primeiro objeto de pergunta:
        var perguntaAtual = perguntas[indiceAtual];

        // utilizando a perguntaAtual, que está em 0, para acessar a propriedade de pergunta do meu json
        // e colocar dentro do h2 
        h2_pergunta.innerHTML = perguntaAtual.pergunta;

        // div que vai as alternativas da pergunta
        alternativa.innerHTML = "";


        // para cada loop, a div_alternativas vai receber as alternativas do meu json
        // perguntaAtual é a pergunta que eu estou,
        // alternativas.length é a quantidade de alternativas na propriedade alternativas do meu json
        for (var i = 0; i < perguntaAtual.alternativas.length; i++) {
            alternativa.innerHTML += `<label><input type="radio" name="pergunta">${perguntaAtual.alternativas[i]}</label>`
        }
    }

    // o botao para pular para a próxima pergunta
    function proxima() {

        //essa varialvel tem a funcao de através de uma consulta de seleção,
        // verificar se a input está selecionada, utilizando como identificação
        // o parâmetro de "name", ou seja, procurando qualquer input que faça parte
        // desse grupo/name, que esteja selecionada.
        var selecionada = document.querySelector("input[name='pergunta']:checked");
    

        //se a variavel selecionada não achar nenhum elemento selecionado
        //return utilizado para não executar mais código se selecionada estiver nulo
        if (selecionada == null) {
            alert("Selecione uma alternativa!");
            return;
        } else {

            // essa variavel vai utilizar a minha variavel selecionada
            // utiliza o nextSibling para "caminhar" para o lado da input,
            // acessando o texto da label e lendo esse texto com nodeValue.
            var textoSelecionado = selecionada.nextSibling.nodeValue;

            // puxa o valor da variavel global que está em zero.
            var perguntaAtual = perguntas[indiceAtual];

            // verifica se o valor da input selecionada é igual a minha 
            // propriedade da minha primeira pergunta. Se estiver correta,
            // a variavel global contAcerto vai receber mais 1.
            if (textoSelecionado == perguntaAtual.certa) {
                contAcerto++;
                console.log(textoSelecionado);
            }
            console.log(contAcerto);

            // depois de validar a pergunta 1, vamos para a proxima,
            // utilizando o indiceAtual, que continuara percorrendo a minha lista.
            indiceAtual++;
            if (indiceAtual >= perguntas.length) {
                
                document.getElementById("proxima").innerHTML = "Finalizar"
                document.getElementById("proxima").setAttribute("onclick", "finalizarQuiz()");
                
            } else {
                carregarPergunta();
            }
        }
    }

    // essa funcao vai finalizar o quiz. Pega a contAcerto e cria a variavel erros,
    // na dashboard, nas kpis vou mostrar os acertos e erros na ultima tentativa?
    function finalizarQuiz() {
        alert('Quiz finalizado');
        document.getElementById("areaQuiz").innerHTML = telaInicial;

        erros = perguntas.length - contAcerto;

        fetch("/tentativa/registrarTentativa", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                contAcertoServer: contAcerto,
                fkUsuarioServer: fkUsuario,
                erroServer: erro,
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log('Tentativa registrada!')

                } else {
                    throw "Erro ao registrar tentativa!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                return false;
            });

        indiceAtual = 0;
        contAcerto = 0;
        erro = 0;
        //document.getElementById("areaQuiz").innerHTML = telaInicial;

    }

</script>